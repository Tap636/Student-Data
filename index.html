<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NGVM PASSCAP</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: black;
      font-family: Arial, sans-serif;
      color: white;
    }

    /* Top Bar */
    .top-bar {
      position: absolute;
      top: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background: rgba(0, 0, 0, 0.4);
      z-index: 2;
    }
    .top-bar button {
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }

    /* Video Fullscreen */
    #video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Capture Button */
    .bottom-bar {
      position: absolute;
      bottom: 30px;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2;
    }
    #captureBtn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 5px solid white;
      background: rgba(255,255,255,0.1);
      cursor: pointer;
    }

    /* Hidden canvas */
    #canvas {
      display: none;
    }

    /* Popup Form */
    #formPopup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.9);
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 5;
      text-align: center;
    }
    #formPopup input, #formPopup select, #formPopup button {
      margin: 8px;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }
    #formPopup button {
      background: #007bff;
      color: white;
      cursor: pointer;
    }

    /* Toast Notification */
    #toast {
      position: absolute;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      padding: 10px 20px;
      border-radius: 20px;
      display: none;
      z-index: 10;
    }
  </style>
</head>
<body>

  <!-- Top Bar -->
  <div class="top-bar">
    <button id="clearBtn">üóëÔ∏è Clear Data</button>
    <h3>NGVM PASSCAP</h3>
    <button id="downloadBtn">‚¨áÔ∏è Download ZIP</button>
  </div>

  <!-- Video -->
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>

  <!-- Capture Button -->
  <div class="bottom-bar">
    <button id="captureBtn"></button>
  </div>

  <!-- Popup Form -->
  <div id="formPopup">
    <h3>Enter Details</h3>
    <input type="text" id="studentName" placeholder="Student Name" required>
    <select id="studentClass">
      <option value="">Select Class</option>
      <option value="NUR">Nursery</option>
      <option value="LKG">LKG</option>
      <option value="UKG">UKG</option>
      <option value="1">1st</option>
      <option value="2">2nd</option>
      <option value="3">3rd</option>
      <option value="4">4th</option>
      <option value="5">5th</option>
      <option value="6">6th</option>
      <option value="7">7th</option>
      <option value="8">8th</option>
      <option value="9">9th</option>
      <option value="10">10th</option>
      <option value="11">11th</option>
      <option value="12">12th</option>
    </select>
    <br>
    <button id="saveBtn">Save</button>
  </div>

  <!-- Toast -->
  <div id="toast">Saved!</div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const captureBtn = document.getElementById('captureBtn');
    const formPopup = document.getElementById('formPopup');
    const saveBtn = document.getElementById('saveBtn');
    const toast = document.getElementById('toast');
    const clearBtn = document.getElementById('clearBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    let photos = [];

    // ‚úÖ Open high-quality rear camera
    navigator.mediaDevices.getUserMedia({
      video: { facingMode: "environment", width: { ideal: 1920 }, height: { ideal: 1080 } }
    })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(err => alert("Camera access denied: " + err));

    // ‚úÖ Capture photo
    captureBtn.addEventListener('click', () => {
      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      formPopup.style.display = 'block';
    });

    // ‚úÖ Save photo with name & class
    saveBtn.addEventListener('click', () => {
      const studentName = document.getElementById('studentName').value.trim();
      const studentClass = document.getElementById('studentClass').value;

      if (!studentName || !studentClass) {
        alert("Please enter both name and class!");
        return;
      }

      canvas.toBlob(blob => {
        photos.push({ name: studentName, class: studentClass, blob });
        showToast("‚úÖ Saved");
      }, 'image/jpeg', 0.95);

      formPopup.style.display = 'none';
      document.getElementById('studentName').value = "";
      document.getElementById('studentClass').value = "";
    });

    // ‚úÖ Show toast
    function showToast(msg) {
      toast.innerText = msg;
      toast.style.display = 'block';
      setTimeout(() => {
        toast.style.display = 'none';
      }, 2000);
    }

    // ‚úÖ Clear Data
    clearBtn.addEventListener('click', () => {
      photos = [];
      showToast("üóëÔ∏è Data Cleared");
    });

    // ‚úÖ Download ZIP
    downloadBtn.addEventListener('click', () => {
      if (photos.length === 0) {
        alert("No photos to download!");
        return;
      }
      const zip = new JSZip();
      photos.forEach(p => {
        zip.file(`${p.class}-${p.name}.jpg`, p.blob);
      });
      zip.generateAsync({ type: "blob" }).then(content => {
        saveAs(content, `students_photos.zip`);
      });
    });
  </script>

</body>
</html>
