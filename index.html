<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NGVM PASSCAP</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, orange, blue);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      background: rgba(0,0,0,0.4);
      width: 100%;
      text-align: center;
      padding: 15px;
      font-size: 28px;
      font-weight: bold;
    }
    #newProjectBtn {
      position: absolute;
      top: 70px;
      left: 20px;
      padding: 8px 14px;
      font-size: 14px;
      background: #fff;
      color: #000;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    video, canvas {
      border: 3px solid #fff;
      border-radius: 10px;
      margin: 15px 0;
      max-width: 100%;
      width: 500px;
      height: 380px;
      object-fit: cover;
    }
    .hidden { display: none; }
    input, select {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
    }
    button {
      cursor: pointer;
    }
    .capture-btn {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      border: none;
      background: #fff;
      color: black;
      font-size: 16px;
      font-weight: bold;
      margin: 20px 0;
      cursor: pointer;
      box-shadow: 0px 4px 10px rgba(0,0,0,0.5);
      transition: 0.2s;
    }
    .capture-btn:hover {
      transform: scale(1.05);
    }
    #formSection {
      margin-top: 10px;
    }
    #gallery {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
    }
    .photo-card {
      background: rgba(255,255,255,0.1);
      border: 1px solid #fff;
      border-radius: 12px;
      padding: 10px;
      margin: 10px;
      text-align: center;
    }
    .photo-card img {
      width: 150px;
      height: 180px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #fff;
    }
    .download-btn {
      margin-top: 5px;
      background: #fff;
      color: black;
      padding: 5px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #downloadZipSection {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>

  <header>ðŸ“¸ NGVM PASSCAP</header>
  <button id="newProjectBtn">New Project</button>

  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" width="500" height="380" class="hidden"></canvas>

  <div id="formSection" class="hidden">
    <h3>Enter Details</h3>
    <input type="text" id="studentName" placeholder="Student Name" required>
    <select id="studentClass" required>
      <option value="">Select Class</option>
      <option value="Nur">Nur</option>
      <option value="LKG">LKG</option>
      <option value="UKG">UKG</option>
      <option value="1st">1st</option>
      <option value="2nd">2nd</option>
      <option value="3rd">3rd</option>
      <option value="4th">4th</option>
      <option value="5th">5th</option>
      <option value="6th">6th</option>
      <option value="7th">7th</option>
      <option value="8th">8th</option>
      <option value="9th">9th</option>
      <option value="10th">10th</option>
      <option value="11th">11th</option>
      <option value="12th">12th</option>
    </select>
  </div>

  <!-- âœ… Big round capture button -->
  <button id="captureBtn" class="capture-btn">CAPTURE</button>

  <div id="gallery"></div>

  <div id="downloadZipSection">
    <h3>Download ZIP by Class</h3>
    <select id="downloadClass">
      <option value="">Select Class</option>
      <option value="Nur">Nur</option>
      <option value="LKG">LKG</option>
      <option value="UKG">UKG</option>
      <option value="1st">1st</option>
      <option value="2nd">2nd</option>
      <option value="3rd">3rd</option>
      <option value="4th">4th</option>
      <option value="5th">5th</option>
      <option value="6th">6th</option>
      <option value="7th">7th</option>
      <option value="8th">8th</option>
      <option value="9th">9th</option>
      <option value="10th">10th</option>
      <option value="11th">11th</option>
      <option value="12th">12th</option>
    </select>
    <button id="downloadZipBtn" class="download-btn">Download ZIP</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const context = canvas.getContext('2d');
    const captureBtn = document.getElementById('captureBtn');
    const formSection = document.getElementById('formSection');
    const gallery = document.getElementById('gallery');
    const downloadClass = document.getElementById('downloadClass');
    const downloadZipBtn = document.getElementById('downloadZipBtn');
    const newProjectBtn = document.getElementById('newProjectBtn');

    let photos = [];

    // âœ… Open REAR camera
    navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: "environment" } } })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(err => {
        alert("Camera access error: " + err);
      });

    // âœ… Capture photo
    captureBtn.addEventListener('click', () => {
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      formSection.classList.remove('hidden');

      const saveBtn = document.createElement('button');
      saveBtn.textContent = "Save Image";
      saveBtn.className = "download-btn";

      // remove duplicate button if re-capturing
      if (document.getElementById('saveBtn')) {
        document.getElementById('saveBtn').remove();
      }
      saveBtn.id = "saveBtn";
      formSection.appendChild(saveBtn);

      saveBtn.addEventListener('click', () => {
        const studentName = document.getElementById('studentName').value.trim();
        const studentClass = document.getElementById('studentClass').value;

        if (!studentName || !studentClass) {
          alert("Please enter name and select class!");
          return;
        }

        canvas.toBlob(blob => {
          const imgURL = URL.createObjectURL(blob);
          const imgElement = document.createElement('img');
          imgElement.src = imgURL;

          const card = document.createElement('div');
          card.className = "photo-card";
          card.innerHTML = `<p>${studentName} (${studentClass})</p>`;
          card.appendChild(imgElement);

          gallery.appendChild(card);

          // store in memory
          photos.push({ name: studentName, class: studentClass, blob });

          // clear form
          document.getElementById('studentName').value = "";
          document.getElementById('studentClass').value = "";
          formSection.classList.add('hidden');
        }, 'image/jpeg');
      });
    });

    // âœ… Download ZIP for class
    downloadZipBtn.addEventListener('click', () => {
      const selectedClass = downloadClass.value;
      if (!selectedClass) {
        alert("Please select a class!");
        return;
      }

      const classPhotos = photos.filter(p => p.class === selectedClass);
      if (classPhotos.length === 0) {
        alert("No photos found for " + selectedClass);
        return;
      }

      const zip = new JSZip();
      classPhotos.forEach((p) => {
        const fileName = `${p.name}.jpg`; // âœ… only name
        zip.file(fileName, p.blob);
      });

      zip.generateAsync({ type: "blob" }).then(content => {
        saveAs(content, `${selectedClass}_photos.zip`);
      });
    });

    // âœ… New Project - Clear gallery and reset
    newProjectBtn.addEventListener('click', () => {
      if (confirm("Start a new project? This will clear all data.")) {
        photos = [];
        gallery.innerHTML = "";
      }
    });
  </script>

</body>
</html>
