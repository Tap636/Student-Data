<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NGVM PASSCAP</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      font-family: Arial, sans-serif;
      color: white;
    }
    /* Fullscreen camera */
    #camera-container {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    video, canvas {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
    }
    /* Top bar */
    #topBar {
      position: fixed;
      top: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 15px;
      z-index: 20;
    }
    #topBar button {
      background: rgba(0,0,0,0.5);
      border: none;
      color: white;
      font-size: 20px;
      padding: 14px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
    }
    #topBar button:active {
      background: rgba(255,255,255,0.2);
    }
    /* Big Capture Button */
    #captureBtn {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      width: 90px;
      height: 90px;
      background: white;
      border-radius: 50%;
      border: 6px solid #ccc;
      cursor: pointer;
      z-index: 20;
    }
    /* Modal for details */
    #formModal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 30;
    }
    #formBox {
      background: white;
      color: black;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      width: 280px;
    }
    #formBox input, #formBox select, #formBox button {
      margin: 8px 0;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    /* Notify */
    #notify {
      position: fixed;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      background: green;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      display: none;
      z-index: 40;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <!-- Top bar -->
  <div id="topBar">
    <button id="clearDataBtn">üóëÔ∏è Clear Data</button>
    <button id="downloadZipBtn">‚¨áÔ∏è Download</button>
  </div>

  <!-- Camera -->
  <div id="camera-container">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" class="hidden"></canvas>
  </div>

  <!-- Capture button -->
  <button id="captureBtn"></button>

  <!-- Modal for details -->
  <div id="formModal">
    <div id="formBox">
      <h3>Enter Details</h3>
      <input type="text" id="studentName" placeholder="Student Name" required>
      <select id="studentClass" required>
        <option value="">Select Class</option>
        <option>NUR</option><option>LKG</option><option>UKG</option>
        <option>1st</option><option>2nd</option><option>3rd</option>
        <option>4th</option><option>5th</option><option>6th</option>
        <option>7th</option><option>8th</option><option>9th</option>
        <option>10th</option><option>11th</option><option>12th</option>
      </select>
      <button id="saveBtn">Save</button>
    </div>
  </div>

  <!-- Saved notification -->
  <div id="notify">‚úÖ Saved!</div>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const context = canvas.getContext('2d');
    const captureBtn = document.getElementById('captureBtn');
    const formModal = document.getElementById('formModal');
    const saveBtn = document.getElementById('saveBtn');
    const clearDataBtn = document.getElementById('clearDataBtn');
    const downloadZipBtn = document.getElementById('downloadZipBtn');
    const notify = document.getElementById('notify');

    let photos = [];

    // ‚úÖ Open rear camera with best quality
    navigator.mediaDevices.getUserMedia({ 
      video: { facingMode: "environment", width: { ideal: 4096 }, height: { ideal: 2160 } }
    })
    .then(stream => { video.srcObject = stream; })
    .catch(err => alert("Camera error: " + err));

    // ‚úÖ Capture
    captureBtn.addEventListener('click', () => {
      canvas.width = 1080;
      canvas.height = 1440;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      video.classList.add('hidden');
      canvas.classList.remove('hidden');
      formModal.style.display = 'flex';
    });

    // ‚úÖ Save photo
    saveBtn.addEventListener('click', () => {
      const name = document.getElementById('studentName').value.trim();
      const sclass = document.getElementById('studentClass').value.trim();

      if (!name || !sclass) {
        alert("Enter both name & class!");
        return;
      }

      canvas.toBlob(blob => {
        photos.push({ class: sclass, name, blob });
      }, 'image/jpeg', 0.95);

      // reset
      document.getElementById('studentName').value = '';
      document.getElementById('studentClass').value = '';
      video.classList.remove('hidden');
      canvas.classList.add('hidden');
      formModal.style.display = 'none';

      // notify
      notify.style.display = 'block';
      setTimeout(()=> notify.style.display='none', 1500);
    });

    // ‚úÖ Clear Data
    clearDataBtn.addEventListener('click', () => {
      if(confirm("Clear all saved images?")){
        photos = [];
        alert("All data cleared.");
      }
    });

    // ‚úÖ Download ZIP
    downloadZipBtn.addEventListener('click', () => {
      if (photos.length === 0) { alert("No photos saved."); return; }
      const zip = new JSZip();
      photos.forEach(p => {
        zip.file(`${p.name}.jpg`, p.blob);
      });
      zip.generateAsync({type:"blob"}).then(content=>{
        saveAs(content, "photos.zip");
      });
    });
  </script>

</body>
</html>
